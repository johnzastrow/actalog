# docker-compose.external-host.yml
version: '3.8'

services:
  actalog:
    image: ghcr.io/johnzastrow/actalog:latest
    container_name: actalog
    restart: unless-stopped
    ports:
      - "8080:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      # Connect to host database
      - DB_DRIVER=mysql
      - DB_HOST=host.docker.internal  # Works on Linux with extra_hosts above
      # - DB_HOST=172.17.0.1          # Alternative: Linux default bridge IP
      - DB_PORT=3306
      - DB_NAME=acta
      - DB_USER=acta
      - DB_PASSWORD=${DB_PASSWORD}
      - MARIADB_ROOT_PASSWORD=${DB_ROOT_PASSWORD:?SillyBanana392-}
      - MARIADB_CHARACTER_SET=utf8mb4
      - MARIADB_COLLATION=utf8mb4_unicode_ci


      # Application config
      - JWT_SECRET=${JWT_SECRET}
      - APP_URL=${APP_URL:-http://localhost:8080}
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:8080}

      # Optional: automatic seed import
      - ADMIN_EMAIL=${ADMIN_EMAIL:-}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}

    volumes:
      - actalog-uploads:/app/uploads

    # No database container needed!

volumes:
  actalog-uploads:
